<!doctype html>
<html>
<meta charset="utf-8" />
    <head>
        <style>
            img {
                width: 760px;
                height: 886px;
            }
            canvas {
                border: 5px solid black;
            }
        </style>
    </head>
    <body>
        <canvas id='myCanvas'>
        </canvas>
        <button id="link">저장하기</button>
    </body>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext("2d");
        const box = {x: 70, y: 240};
        const check = [
            [false, false, false, false, false],
            [false, false, false, false, false],
            [false, false, false, false, false],
            [false, false, false, false, false],
            [false, false, false, false, false],
        ]
        const bg = new Image();
        bg.crossOrigin="anonymous";
        function reset(){
            canvas.width  = 760;//635;
            canvas.height = 886;//615;
            bg.addEventListener("load", function() {
                ctx.drawImage(bg,0,0);
            }, false);
            bg.src = './1.jpg';
        }
        function draw(){
            ctx.drawImage(bg,0,0);

            for(let i = 0; i < 5; i++){
                for(let j = 0; j < 5; j++){
                    if(check[i][j])
                        drawCircle(i,j);
                }
            }
        }
        function drawCircle(x,y){
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(box.x+55+130*x, box.y+55+125*y, 60, 0, 2 * Math.PI, true);
            ctx.stroke();
        }
        window.onload = function(){
            reset();
            canvas.onclick = function(event){
                const mouse = {x: event.layerX, y: event.layerY};
                const result = {x: -1, y: -1}
                for(let i = 0; i < 5; i++){
                    if(box.x+130*i < mouse.x && mouse.x < box.x+130*(i+1)){
                        result.x = i;
                    }
                    if(box.y+125*i < mouse.y && mouse.y < box.y+125*(i+1)){
                        result.y = i;
                    }
                }

                check[result.x][result.y] = !check[result.x][result.y];
                draw();
            }
            var link = document.getElementById('link');
            link.setAttribute('download', 'assaBingo.png');
            var img = new Image();
            img.crossOrigin = "anonymous";
            img.src = canvas.toDataURL('image/png');
            link.onclick = ()=>{
                downloadImage(img, "bingo");
            };
        }
        function downloadImage(img, fileName) {
            var imgData = atob(img.src.split(',')[1]),
                len = imgData.length,
                buf = new ArrayBuffer(len),
                view = new Uint8Array(buf),
                blob,
                i;

            for (i = 0; i < len; i++) {
                view[i] = imgData.charCodeAt(i) & 0xff; // masking
            }

            blob = new Blob([view], {
                type: 'application/octet-stream',
            });

            if (window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveOrOpenBlob(blob, fileName);
            } else {
                //var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.style = 'display: none';
                //a.href = url;
                a.href = img.src;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();

                setTimeout(function () {
                document.body.removeChild(a);
                //URL.revokeObjectURL(url);
                }, 100);
            }
            }
    </script>
</html>

